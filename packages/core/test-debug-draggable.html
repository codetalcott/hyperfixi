<!DOCTYPE html>
<html>
<head>
    <title>Debug Draggable Test</title>
    <style>
        .box {
            width: 100px;
            height: 100px;
            background: #007bff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            cursor: move;
            user-select: none;
        }
    </style>
</head>
<body>
    <h1>Draggable Debug Test</h1>
    <div class="box" style="left: 100px; top: 100px;" _="install Draggable()">Box 1</div>

    <script>
        window.__HYPERFIXI_DEBUG__ = true;
        console.log('=== ENABLING DEBUG MODE ===');
    </script>
    <script src="dist/hyperfixi-browser.js"></script>

    <script type="text/hyperscript">
behavior Draggable(dragHandle)
  init
    log 'Draggable init called'
    if no dragHandle set the dragHandle to me
    log 'dragHandle set to:', dragHandle
  end
  on pointerdown(clientX, clientY) from dragHandle
    log 'POINTERDOWN FIRED!', clientX, clientY
    halt the event
    trigger draggable:start
    measure x
    log 'Measured x:', it
    set startX to it
    measure y
    log 'Measured y:', it
    set startY to it
    set xoff to clientX - startX
    set yoff to clientY - startY
    log 'Offsets - xoff:', xoff, 'yoff:', yoff
    repeat until event pointerup from document
      wait for pointermove(clientX, clientY) or
               pointerup(clientX, clientY) from document
      log 'Moving to:', clientX - xoff, clientY - yoff
      add { left: ${clientX - xoff}px; top: ${clientY - yoff}px; }
      trigger draggable:move
    end
    log 'Drag complete'
    trigger draggable:end
  end
end
    </script>

    <script>
        console.log('=== TEST PAGE LOADED ===');
        console.log('HyperFixi available:', typeof window.hyperfixi !== 'undefined');
        console.log('Debug enabled:', window.__HYPERFIXI_DEBUG__);

        // Check if behavior was registered
        setTimeout(() => {
            const box = document.querySelector('.box');
            console.log('Box element:', box);
            console.log('Box has _hyperscript attr:', box.getAttribute('_'));
            console.log('Registered behaviors:', window.hyperfixi?.runtime?.behaviors);
        }, 100);
    </script>
</body>
</html>
