<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>02: Fetch Data - HyperFixi Examples</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .breadcrumb {
            color: #666;
            margin-bottom: 30px;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .description {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .demo {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            margin: 30px 0;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
            font-weight: 600;
            margin: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.loading {
            opacity: 0.6;
            cursor: wait;
        }

        .user-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .user-card h3 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }

        .user-card p {
            margin: 5px 0;
            opacity: 0.95;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
            font-size: 48px;
            animation: spin 1s linear infinite;
        }

        .loading-spinner.show {
            display: block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .data-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .list-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .list-item:hover {
            background: #e9ecef;
        }

        .list-item h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .list-item p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .code {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
        }

        .keyword {
            color: #c678dd;
        }

        .string {
            color: #98c379;
        }

        .comment {
            color: #5c6370;
        }

        .explanation {
            margin: 20px 0;
            line-height: 1.8;
        }

        .tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 14px;
            margin: 5px;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .nav-buttons a {
            background: #f0f0f0;
            color: #333;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            transition: background 0.2s;
        }

        .nav-buttons a:hover {
            background: #e0e0e0;
        }

        .error-box {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            display: none;
        }

        .error-box.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="breadcrumb">
            <a href="../index.html">‚Üê Back to Gallery</a> / <strong>Intermediate</strong> / 02: Fetch Data
        </div>

        <h1>üåê Fetch Data from APIs</h1>

        <div class="description">
            <strong>Load data from external APIs dynamically</strong><br>
            Learn how to make HTTP requests using the <code>call</code> command with JavaScript's native Fetch API.
            This approach lets you fetch JSON, text, and other data from APIs directly from hyperscript!
            <br><br>
            <strong>Note:</strong> We use <code>call fetch()</code> to invoke the browser's native Fetch API,
            which works seamlessly with hyperscript's promise handling.
        </div>

        <div>
            <span class="tag">call</span>
            <span class="tag">fetch</span>
            <span class="tag">JSON</span>
            <span class="tag">async</span>
        </div>

        <!-- Demo 1: Fetch User -->
        <div class="demo">
            <h2>Demo 1: Fetch Random User</h2>
            <p>Click the button to load a random user from JSONPlaceholder API:</p>

            <button
                id="fetch-user-btn"
                _="on click
                   add .loading to me
                   show #spinner
                   hide #user-data
                   call fetch('https://jsonplaceholder.typicode.com/users/1').then(r => r.json())
                   put it into userData
                   put `<h3>${userData.name}</h3>
                        <p>üìß ${userData.email}</p>
                        <p>üè¢ ${userData.company.name}</p>
                        <p>üìç ${userData.address.city}, ${userData.address.street}</p>
                        <p>üìû ${userData.phone}</p>` into #user-data
                   hide #spinner
                   show #user-data
                   remove .loading from me"
            >
                Load User Data
            </button>

            <div id="spinner" class="loading-spinner">‚è≥</div>
            <div id="user-data"></div>
        </div>

        <!-- Demo 2: Fetch Posts List -->
        <div class="demo">
            <h2>Demo 2: Load Blog Posts</h2>
            <p>Load a list of posts from the API:</p>

            <button
                _="on click
                   add .loading to me
                   show #posts-spinner
                   hide #posts-list
                   call fetch('https://jsonplaceholder.typicode.com/posts?_limit=5').then(r => r.json())
                   put it into posts
                   set html to ''
                   repeat for post in posts
                     set html to html + `<div class='list-item'>
                       <h4>${post.title}</h4>
                       <p>${post.body}</p>
                     </div>`
                   end
                   put html into #posts-list
                   hide #posts-spinner
                   show #posts-list
                   remove .loading from me"
            >
                Load Posts
            </button>

            <div id="posts-spinner" class="loading-spinner">‚è≥</div>
            <div id="posts-list" class="data-list"></div>
        </div>

        <!-- Demo 3: Error Handling -->
        <div class="demo">
            <h2>Demo 3: Error Handling</h2>
            <p>Try fetching from an invalid endpoint to see error handling:</p>

            <button
                _="on click
                   hide #error-box
                   add .loading to me
                   try
                     call fetch('https://jsonplaceholder.typicode.com/invalid').then(r => r.json())
                     log it
                   catch error
                     put 'Failed to load data: ' + error into #error-message
                     show #error-box
                   end
                   remove .loading from me"
            >
                Test Error Handling
            </button>

            <div id="error-box" class="error-box">
                <strong>‚ùå Error:</strong>
                <span id="error-message"></span>
            </div>
        </div>

        <!-- Code Explanation -->
        <h2>The Code</h2>

        <h3>Basic Fetch:</h3>
        <div class="code">
&lt;button <span class="keyword">_</span>=<span class="string">"on click
        call fetch('https://api.example.com/data').then(r => r.json())
        put it into #output"</span>&gt;
  Load Data
&lt;/button&gt;
        </div>

        <h3>With Loading State:</h3>
        <div class="code">
&lt;button <span class="keyword">_</span>=<span class="string">"on click
        add .loading to me
        show #spinner
        call fetch('https://api.example.com/users').then(r => r.json())
        put it into userData
        <span class="comment">-- Process the data</span>
        hide #spinner
        remove .loading from me"</span>&gt;
  Fetch
&lt;/button&gt;
        </div>

        <h3>Loop Through Results:</h3>
        <div class="code">
&lt;button <span class="keyword">_</span>=<span class="string">"on click
        call fetch('https://api.example.com/posts').then(r => r.json())
        put it into posts
        set html to ''
        repeat for post in posts
          set html to html + `&lt;div&gt;${post.title}&lt;/div&gt;`
        end
        put html into #list"</span>&gt;
  Load Posts
&lt;/button&gt;
        </div>

        <h3>Error Handling:</h3>
        <div class="code">
&lt;button <span class="keyword">_</span>=<span class="string">"on click
        try
          call fetch('https://api.example.com/data').then(r => r.json())
          put it into #output
        catch error
          put 'Error: ' + error into #error-message
          show #error-box
        end"</span>&gt;
  Load
&lt;/button&gt;
        </div>

        <div class="explanation">
            <h3>How it works:</h3>
            <ul>
                <li><code>call fetch(URL).then(r => r.json())</code> - Uses native JavaScript Fetch API</li>
                <li><code>put it into variable</code> - Stores the returned promise result</li>
                <li><code>call</code> command - Executes JavaScript functions and waits for promises</li>
                <li><code>repeat for item in items</code> - Loops through array results</li>
                <li><code>try/catch</code> - Handles errors gracefully</li>
                <li>Template literals (<code>`${variable}`</code>) - Embed data in HTML</li>
            </ul>

            <h3>Key Concepts:</h3>
            <ul>
                <li><strong>Call Command:</strong> <code>call</code> lets you execute JavaScript functions from hyperscript</li>
                <li><strong>Native Fetch:</strong> Uses the browser's built-in Fetch API</li>
                <li><strong>Promise Handling:</strong> <code>call</code> automatically waits for promises to resolve</li>
                <li><strong>Result Variable:</strong> <code>it</code> contains the resolved promise value</li>
                <li><strong>Template Literals:</strong> Use backticks for string interpolation</li>
                <li><strong>Error Handling:</strong> <code>try/catch</code> for network errors</li>
            </ul>

            <h3>Response Parsing Options:</h3>
            <ul>
                <li><code>.then(r => r.json())</code> - Parse JSON response</li>
                <li><code>.then(r => r.text())</code> - Get plain text response</li>
                <li><code>.then(r => r.blob())</code> - Get binary blob</li>
                <li><code>.then(r => r.arrayBuffer())</code> - Get array buffer</li>
            </ul>

            <h3>HTTP Methods:</h3>
            <div class="code">
<span class="comment">&lt;!-- POST request --&gt;</span>
call fetch('/api/users', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ name: 'John', email: 'john@example.com' })
}).then(r => r.json())
put it into newUser

<span class="comment">&lt;!-- PUT request --&gt;</span>
call fetch('/api/users/1', {
  method: 'PUT',
  body: JSON.stringify({ name: 'Updated Name' })
}).then(r => r.json())
put it into updatedUser

<span class="comment">&lt;!-- DELETE request --&gt;</span>
call fetch('/api/users/1', { method: 'DELETE' })
log 'User deleted'
            </div>

            <h3>Common Use Cases:</h3>
            <ul>
                <li><strong>Load User Data:</strong> Fetch and display profile information</li>
                <li><strong>Blog Posts:</strong> Load and render article lists</li>
                <li><strong>Search Results:</strong> Fetch filtered data based on input</li>
                <li><strong>Form Submission:</strong> POST data to server</li>
                <li><strong>Auto-complete:</strong> Fetch suggestions as user types</li>
                <li><strong>Pagination:</strong> Load more items on button click</li>
            </ul>

            <h3>Try it yourself:</h3>
            <ul>
                <li>Add search functionality that fetches based on input</li>
                <li>Implement pagination (load more button)</li>
                <li>Create a real-time search with debouncing</li>
                <li>POST form data to an API endpoint</li>
                <li>Add authentication headers to requests</li>
            </ul>
        </div>

        <!-- Navigation -->
        <div class="nav-buttons">
            <a href="01-form-validation.html">‚Üê Previous: Form Validation</a>
            <a href="03-fade-effects.html">Next: Fade Effects ‚Üí</a>
        </div>
    </div>

    <!-- Load HyperFixi -->
    <script src="../../packages/core/dist/hyperfixi-browser.js"></script>
</body>
</html>
